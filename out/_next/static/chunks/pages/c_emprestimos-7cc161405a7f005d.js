(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80],{5546:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/c_emprestimos",function(){return o(8176)}])},1089:function(e,t,o){"use strict";o.d(t,{t:function(){return s}});var i=o(5893),r=o(7294),a=o(1163),n=o(6816);function s(e,t){return function(o){let s=(0,a.useRouter)(),[l,u]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{var e;let{data:{user:o},error:i}=await n.O.auth.getUser();if(i||!o){s.push("/login");return}let r=null===(e=o.user_metadata)||void 0===e?void 0:e.role;if(!r||!t.includes(r)){s.push("/unauthorized");return}u(r),c(!1)})()},[s,t]),d)?(0,i.jsx)("p",{children:"Carregando..."}):l?(0,i.jsx)(e,{...o,role:l}):null}}},8176:function(e,t,o){"use strict";o.r(t);var i=o(5893),r=o(9332),a=o(7294),n=o(6816),s=o(1089),l=o(2761),u=o(2089),d=o(7221);t.default=(0,s.t)(function(){let e=(0,r.useRouter)(),[t,o]=(0,a.useState)(null),[s,c]=(0,a.useState)([]),[m,p]=(0,a.useState)(null),[f,h]=(0,a.useState)(null),[x,v]=(0,a.useState)(null),[b,g]=(0,a.useState)(null);(0,a.useEffect)(()=>{async function e(){let{data:{user:e}}=await n.O.auth.getUser();if(!e){h("Usu\xe1rio n\xe3o autenticado");return}let{data:t}=await n.O.from("alunos").select("id").eq("user_id",e.id).maybeSingle();if(t)g({id:t.id,tipo:"aluno"});else{let{data:t}=await n.O.from("funcionarios").select("id").eq("user_id",e.id).maybeSingle();t?g({id:t.id,tipo:"funcionario"}):h("Usu\xe1rio n\xe3o encontrado nas tabelas de alunos ou funcion\xe1rios")}}(async function(){let{data:e,error:t}=await n.O.from("livros").select("id, nome").gt("q_disponivel",0).order("nome");!t&&e?c(e):h("Erro ao carregar os livros dispon\xedveis")})(),e()},[]);let w=s.map(e=>({value:e.id,label:e.nome}));async function _(e){if(e.preventDefault(),p(null),h(null),!b){h("Usu\xe1rio n\xe3o autenticado corretamente.");return}if(!t){h("Selecione um livro");return}if(!s.find(e=>e.id===t.value)){h("Livro n\xe3o encontrado");return}let{data:i,error:r}=await n.O.from("livros").select("q_disponivel").eq("id",t.value).maybeSingle();if(r||!i){h("Erro ao obter dados do livro");return}if(i.q_disponivel<=0){h("N\xe3o h\xe1 exemplares dispon\xedveis");return}let{data:a}=await n.O.from("emprestimos").select("*").eq("nome_livro",t.value).eq("solicitante_id",b.id).eq("tipo_solicitante",b.tipo).is("devolvido",null).maybeSingle();if(a){h("Voc\xea j\xe1 possui este livro emprestado.");return}let l=new Date,u=new Date;u.setDate(l.getDate()+30);let{error:d}=await n.O.from("emprestimos").insert([{nome_livro:t.value,solicitante_id:b.id,tipo_solicitante:b.tipo,data_devolucao:u.toISOString()}]);if(d){h("Erro ao registrar empr\xe9stimo");return}let{error:c}=await n.O.from("livros").update({q_disponivel:i.q_disponivel-1}).eq("id",t.value);if(c){h("Erro ao atualizar quantidade de livros");return}v(u.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})),p("Empr\xe9stimo efetuado com sucesso."),o(null)}return(0,i.jsxs)("div",{className:"relative flex flex-col items-center justify-center min-h-screen bg-[#006400] px-4 sm:px-8",children:[(0,i.jsx)("button",{onClick:()=>{b&&("aluno"===b.tipo?e.push("/painel_aluno"):("funcionario"===b.tipo||"funcionario_administrador"===b.tipo)&&e.push("/dashboard"))},disabled:!b,className:"absolute top-4 right-4 rounded-full p-2 shadow-md transition\n          ".concat(b?"bg-white text-[#006400] hover:bg-emerald-100 cursor-pointer":"bg-gray-400 cursor-not-allowed"),children:(0,i.jsx)(l.Z,{className:"w-6 h-6"})}),(0,i.jsxs)("div",{className:"relative z-10 bg-[#2e8b57] rounded-[30px] p-8 sm:p-12 max-w-xl w-full shadow-2xl",children:[(0,i.jsxs)("h1",{className:"text-3xl sm:text-4xl font-bold text-white text-center mb-8 flex items-center justify-center gap-3 drop-shadow",children:[(0,i.jsx)(u.Z,{className:"w-8 h-8"})," Cadastro de Empr\xe9stimos"]}),f&&(0,i.jsx)("p",{className:"text-red-400 text-center mb-4",children:f}),m&&(0,i.jsx)("p",{className:"text-green-400 text-center mb-4",children:m}),(0,i.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,i.jsx)(d.ZP,{options:w,value:t,onChange:e=>o(e),placeholder:"Selecione um livro",isClearable:!0,styles:{control:e=>({...e,backgroundColor:"#006400",borderRadius:"9999px",borderColor:"transparent",paddingLeft:"0.75rem",color:"white",boxShadow:"0 0 10px rgba(0,100,0,0.5)"}),singleValue:e=>({...e,color:"white"}),placeholder:e=>({...e,color:"rgba(255, 255, 255, 0.7)"}),menu:e=>({...e,borderRadius:"15px"}),option:(e,t)=>({...e,backgroundColor:t.isFocused?"#004d00":"white",color:t.isFocused?"white":"black",cursor:"pointer"})}}),(0,i.jsx)("button",{type:"submit",className:"w-full bg-white text-[#006400] font-bold py-4 rounded-full hover:bg-emerald-100 transition shadow-lg",children:"Cadastrar"})]}),x&&(0,i.jsxs)("p",{className:"mt-6 text-center text-white font-medium",children:["Data limite para devolu\xe7\xe3o: ",(0,i.jsx)("strong",{children:x})]})]})]})},["aluno","funcionario","funcionario_administrador"])}},function(e){e.O(0,[332,843,888,774,179],function(){return e(e.s=5546)}),_N_E=e.O()}]);