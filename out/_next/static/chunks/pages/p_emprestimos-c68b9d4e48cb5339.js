(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{7430:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p_emprestimos",function(){return s(7342)}])},1089:function(e,t,s){"use strict";s.d(t,{t:function(){return r}});var a=s(5893),o=s(7294),l=s(1163),i=s(6816);function r(e,t){return function(s){let r=(0,l.useRouter)(),[n,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{(async()=>{var e;let{data:{user:s},error:a}=await i.O.auth.getUser();if(a||!s){r.push("/login");return}let o=null===(e=s.user_metadata)||void 0===e?void 0:e.role;if(!o||!t.includes(o)){r.push("/unauthorized");return}d(o),u(!1)})()},[r,t]),c)?(0,a.jsx)("p",{children:"Carregando..."}):n?(0,a.jsx)(e,{...s,role:n}):null}}},2761:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7342:function(e,t,s){"use strict";s.r(t);var a=s(5893),o=s(1089),l=s(7294),i=s(9332),r=s(6816),n=s(2761),d=s(2089);t.default=(0,o.t)(function(){let e=(0,i.useRouter)(),[t,s]=(0,l.useState)([]),[o,c]=(0,l.useState)(!1),u=async()=>{c(!0);let{data:e,error:t}=await r.O.from("emprestimos").select("*").order("data_emprestimo",{ascending:!1});if(t||!e){console.error(t),alert("Erro ao buscar empr\xe9stimos: "+(null==t?void 0:t.message)),c(!1);return}let a=[];for(let t of e){let{data:e}=await r.O.from("livros").select("nome").eq("id",t.nome_livro).single(),s="Desconhecido";if("aluno"===t.tipo_solicitante){let{data:e}=await r.O.from("alunos").select("nome").eq("id",t.solicitante_id).single();s=(null==e?void 0:e.nome)||s}else if("funcionario"===t.tipo_solicitante){let{data:e}=await r.O.from("funcionarios").select("nome").eq("id",t.solicitante_id).single();s=(null==e?void 0:e.nome)||s}a.push({id:t.id,nome_livro:(null==e?void 0:e.nome)||"Desconhecido",nome_solicitante:s,tipo_solicitante:t.tipo_solicitante,data_emprestimo:new Date(t.data_emprestimo).toLocaleDateString(),data_devolucao:new Date(t.data_devolucao).toLocaleDateString(),devolvido:t.devolvido})}s(a),c(!1)};return(0,l.useEffect)(()=>{u()},[]),(0,a.jsxs)("div",{className:"min-h-screen bg-[#006400] flex flex-col items-center justify-start px-4 py-10 relative",children:[(0,a.jsx)("button",{onClick:()=>e.back(),className:"absolute top-4 right-4 bg-white text-[#006400] rounded-full p-2 shadow-md hover:bg-emerald-100 transition","aria-label":"Voltar",children:(0,a.jsx)(n.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"w-full max-w-6xl bg-[#2e8b57] rounded-[30px] p-8 shadow-2xl z-10 text-white",children:[(0,a.jsxs)("h1",{className:"text-4xl font-bold text-center mb-8 flex items-center justify-center gap-3 drop-shadow",children:[(0,a.jsx)(d.Z,{className:"w-8 h-8"})," Lista de Empr\xe9stimos"]}),o?(0,a.jsx)("p",{className:"text-center text-lg font-semibold",children:"Carregando..."}):0===t.length?(0,a.jsx)("p",{className:"text-center text-lg font-semibold",children:"Nenhum empr\xe9stimo encontrado."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-[#1f6f43] text-white text-sm sm:text-base",children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"Livro"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Solicitante"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Tipo"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Data Empr\xe9stimo"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Data Devolu\xe7\xe3o"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Status"})]})}),(0,a.jsx)("tbody",{children:t.map((e,t)=>(0,a.jsxs)("tr",{className:t%2==0?"bg-[#2e8b57]":"bg-[#237e4d]",children:[(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.nome_livro}),(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.nome_solicitante}),(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400] capitalize",children:e.tipo_solicitante}),(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.data_emprestimo}),(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.data_devolucao}),(0,a.jsx)("td",{className:"px-4 py-3 border border-[#006400] font-semibold ".concat(e.devolvido?"text-green-300":"text-yellow-300"),children:e.devolvido?"Devolvido":"Pendente"})]},e.id))})]})})]})]})},["funcionario","funcionario_administrador"])}},function(e){e.O(0,[332,888,774,179],function(){return e(e.s=7430)}),_N_E=e.O()}]);