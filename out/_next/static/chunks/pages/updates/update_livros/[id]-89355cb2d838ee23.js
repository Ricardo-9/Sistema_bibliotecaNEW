(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{471:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/updates/update_livros/[id]",function(){return a(3205)}])},1089:function(e,t,a){"use strict";a.d(t,{t:function(){return s}});var r=a(5893),n=a(7294),o=a(1163),i=a(6816);function s(e,t){return function(a){let s=(0,o.useRouter)(),[l,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{var e;let{data:{user:a},error:r}=await i.O.auth.getUser();if(r||!a){s.push("/login");return}let n=null===(e=a.user_metadata)||void 0===e?void 0:e.role;if(!n||!t.includes(n)){s.push("/unauthorized");return}u(n),d(!1)})()},[s,t]),c)?(0,r.jsx)("p",{children:"Carregando..."}):l?(0,r.jsx)(e,{...a,role:l}):null}}},2761:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(1134).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3205:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(5893),n=a(7294),o=a(9332),i=a(6816),s=a(1089),l=a(2761);let u=(0,a(1134).Z)("book-check",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);var c=(0,s.t)(function(){let e=(0,o.useRouter)(),{id:t}=(0,o.useParams)(),[a,s]=(0,n.useState)({nome:"",ano_publicacao:"",categoria:"",isbn:"",autor:"",q_disponivel:""}),[c,d]=(0,n.useState)(""),[m,p]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{let{data:e,error:a}=await i.O.from("livros").select("*").eq("id",t).single();if(a){d("Erro ao buscar livro");return}e&&s({nome:e.nome,ano_publicacao:e.ano_publicacao,categoria:e.categoria,isbn:e.isbn,autor:e.autor,q_disponivel:String(e.q_disponivel)})})()},[t]);let f=e=>e.trim().toLowerCase().replace(/\s+/g," "),h=e=>e.replace(/\D/g,""),b=e=>{s({...a,[e.target.name]:e.target.value})},v=async r=>{r.preventDefault(),d(""),p("");let n=f(a.nome),o=h(a.isbn),s=Number(a.q_disponivel),l=Number(a.ano_publicacao),u=new Date().getFullYear();if(!n)return d("O nome do livro \xe9 obrigat\xf3rio.");if(!o||10!==o.length&&13!==o.length)return d("O ISBN deve conter 10 ou 13 d\xedgitos num\xe9ricos.");if(!Number.isInteger(s)||s<0)return d("A quantidade dispon\xedvel deve ser um n\xfamero inteiro positivo.");if(!a.ano_publicacao||isNaN(l)||l<0||l>u)return d("O ano de publica\xe7\xe3o deve ser um n\xfamero v\xe1lido entre 0 e ".concat(u,"."));let{data:c,error:m}=await i.O.from("livros").select("id, nome, isbn").neq("id",t);if(m)return d("Erro ao verificar duplicidade");if(null==c?void 0:c.some(e=>f(e.nome)===n))return d("J\xe1 existe um livro com esse nome.");if(null==c?void 0:c.some(e=>h(e.isbn)===o))return d("J\xe1 existe um livro com esse ISBN.");let{error:b}=await i.O.from("livros").update({nome:a.nome.trim(),ano_publicacao:a.ano_publicacao.trim(),categoria:a.categoria.trim(),isbn:a.isbn.trim(),autor:a.autor.trim(),q_disponivel:s}).eq("id",t);b?d("Erro ao atualizar livro: "+b.message):(p("Livro atualizado com sucesso!"),setTimeout(()=>e.push("/pesq_livros"),2e3))};return(0,r.jsxs)("div",{className:"relative flex flex-col items-center justify-center min-h-screen bg-[#006400] px-4 sm:px-8",children:[(0,r.jsx)("button",{onClick:()=>e.push("/pesq_livros"),className:"absolute top-4 right-4 bg-white text-[#006400] rounded-full p-2 shadow-md hover:bg-emerald-100 transition",children:(0,r.jsx)(l.Z,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{className:"relative z-10 bg-[#2e8b57] rounded-[30px] p-8 sm:p-12 max-w-xl w-full shadow-2xl",children:[(0,r.jsxs)("h1",{className:"text-3xl sm:text-4xl font-bold text-white text-center mb-8 flex items-center justify-center gap-3 drop-shadow",children:[(0,r.jsx)(u,{className:"w-8 h-8"})," Editar Livro"]}),c&&(0,r.jsx)("p",{className:"text-red-400 text-center mb-4",children:c}),m&&(0,r.jsx)("p",{className:"text-green-400 text-center mb-4",children:m}),(0,r.jsxs)("form",{onSubmit:v,className:"space-y-5",children:[[{name:"nome",placeholder:"Nome"},{name:"ano_publicacao",placeholder:"Ano de Publica\xe7\xe3o",type:"number"},{name:"categoria",placeholder:"Categoria"},{name:"autor",placeholder:"Autor"},{name:"q_disponivel",placeholder:"Quantidade Dispon\xedvel",type:"number"},{name:"isbn",placeholder:"ISBN"}].map(e=>{let{name:t,placeholder:n,type:o}=e;return(0,r.jsx)("input",{name:t,type:o||"text",placeholder:n,value:a[t],onChange:b,className:"w-full p-4 rounded-full border-none shadow-inner focus:outline-none focus:ring-4 focus:ring-green-700 text-green-900 font-semibold"},t)}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-white text-[#006400] font-bold py-4 rounded-full hover:bg-emerald-100 transition shadow-lg",children:"Salvar altera\xe7\xf5es"})]})]})]})},["funcionario","funcionario_administrador"])}},function(e){e.O(0,[332,888,774,179],function(){return e(e.s=471)}),_N_E=e.O()}]);