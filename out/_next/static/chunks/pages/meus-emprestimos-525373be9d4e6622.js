(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{4598:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/meus-emprestimos",function(){return a(3099)}])},1089:function(e,t,a){"use strict";a.d(t,{t:function(){return i}});var r=a(5893),o=a(7294),n=a(1163),s=a(6816);function i(e,t){return function(a){let i=(0,n.useRouter)(),[l,d]=(0,o.useState)(null),[u,c]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{(async()=>{var e;let{data:{user:a},error:r}=await s.O.auth.getUser();if(r||!a){i.push("/login");return}let o=null===(e=a.user_metadata)||void 0===e?void 0:e.role;if(!o||!t.includes(o)){i.push("/unauthorized");return}d(o),c(!1)})()},[i,t]),u)?(0,r.jsx)("p",{children:"Carregando..."}):l?(0,r.jsx)(e,{...a,role:l}):null}}},2761:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(1134).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3099:function(e,t,a){"use strict";a.r(t);var r=a(5893),o=a(7294),n=a(9332),s=a(6816),i=a(1089),l=a(2761),d=a(2089);t.default=(0,i.t)(function(){let e=(0,n.useRouter)(),[t,a]=(0,o.useState)([]),[i,u]=(0,o.useState)(!0),[c,m]=(0,o.useState)(null);return(0,o.useEffect)(()=>{(async function(){u(!0),m(null);try{var t;let{data:{user:r},error:o}=await s.O.auth.getUser();if(o||!r){m("Erro na autentica\xe7\xe3o."),e.push("/login");return}let{data:n,error:i}=await s.O.from("alunos").select("id").eq("user_id",r.id).maybeSingle(),l=null!==(t=null==n?void 0:n.id)&&void 0!==t?t:null,d="aluno";if(!l){let{data:e,error:t}=await s.O.from("funcionarios").select("id").eq("user_id",r.id).maybeSingle();(null==e?void 0:e.id)&&(l=e.id,d="funcionario")}if(!l){m("Usu\xe1rio n\xe3o encontrado."),a([]),u(!1);return}let{data:c,error:f}=await s.O.from("emprestimos").select("id, data_devolucao, livros (nome)").eq("solicitante_id",l).eq("tipo_solicitante",d).is("devolvido",null).order("data_devolucao",{ascending:!0});if(f)m("Erro ao buscar empr\xe9stimos."),a([]);else if(Array.isArray(c)){let e=c.map(e=>{var t;return{id:"number"==typeof e.id?e.id:Number(e.id)||0,data_devolucao:null!==(t=e.data_devolucao)&&void 0!==t?t:"",livros:Array.isArray(e.livros)?e.livros.map(e=>({nome:"string"==typeof e.nome?e.nome:"Nome n\xe3o encontrado"})):[]}});a(e),m(null)}else a([]),m(null)}catch(e){m("Erro inesperado ao carregar empr\xe9stimos."),a([])}finally{u(!1)}})()},[e]),(0,r.jsxs)("div",{className:"min-h-screen bg-[#006400] flex flex-col items-center justify-start px-4 py-10 relative",children:[(0,r.jsx)("button",{onClick:()=>e.push("/perfil"),className:"absolute top-4 right-4 bg-white text-[#006400] rounded-full p-2 shadow-md hover:bg-emerald-100 transition","aria-label":"Voltar para perfil",children:(0,r.jsx)(l.Z,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{className:"w-full max-w-6xl bg-[#2e8b57] rounded-[30px] p-8 shadow-2xl z-10 text-white",children:[(0,r.jsxs)("h1",{className:"text-4xl font-bold text-center mb-8 flex items-center justify-center gap-2 drop-shadow",children:[(0,r.jsx)(d.Z,{className:"w-8 h-8"})," Meus Empr\xe9stimos"]}),i?(0,r.jsx)("p",{className:"text-center text-lg font-semibold",children:"Carregando..."}):c?(0,r.jsx)("p",{className:"text-center text-red-400 font-semibold",children:c}):0===t.length?(0,r.jsx)("p",{className:"text-center text-lg font-semibold",children:"Voc\xea n\xe3o possui empr\xe9stimos ativos."}):(0,r.jsx)("div",{className:"grid gap-6",children:t.map(e=>(0,r.jsxs)("div",{className:"bg-[#004d00] rounded-2xl p-6 shadow-md text-white flex flex-col gap-2",children:[(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[(0,r.jsx)("strong",{children:"Livro(s):"})," ",e.livros.length>0?e.livros.map(e=>e.nome).join(", "):"Nome n\xe3o encontrado"]}),(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[(0,r.jsx)("strong",{children:"Data para Devolu\xe7\xe3o:"})," ",e.data_devolucao?new Date(e.data_devolucao).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel"]})]},e.id))})]})]})},["aluno","funcionario","funcionario_administrador"])}},function(e){e.O(0,[332,888,774,179],function(){return e(e.s=4598)}),_N_E=e.O()}]);