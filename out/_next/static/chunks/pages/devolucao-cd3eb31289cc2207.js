(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[976],{9586:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/devolucao",function(){return r(8477)}])},1089:function(e,t,r){"use strict";r.d(t,{t:function(){return i}});var o=r(5893),l=r(7294),a=r(1163),s=r(6816);function i(e,t){return function(r){let i=(0,a.useRouter)(),[n,d]=(0,l.useState)(null),[c,m]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{(async()=>{var e;let{data:{user:r},error:o}=await s.O.auth.getUser();if(o||!r){i.push("/login");return}let l=null===(e=r.user_metadata)||void 0===e?void 0:e.role;if(!l||!t.includes(l)){i.push("/unauthorized");return}d(l),m(!1)})()},[i,t]),c)?(0,o.jsx)("p",{children:"Carregando..."}):n?(0,o.jsx)(e,{...r,role:n}):null}}},2761:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(1134).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6127:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});let o=(0,r(1134).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},8477:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var o=r(5893),l=r(7294),a=r(1163),s=r(6816),i=r(1089),n=r(2761),d=r(3543),c=r(6127),m=r(1134);let u=(0,m.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),p=(0,m.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var x=(0,i.t)(function(){let e=(0,a.useRouter)(),[t,r]=(0,l.useState)([]),[i,m]=(0,l.useState)(""),[x,h]=(0,l.useState)(!1),f=async e=>{h(!0);let t=s.O.from("emprestimos").select("*").order("data_emprestimo",{ascending:!1});if(e&&""!==e.trim()){let{data:o}=await s.O.from("livros").select("id").ilike("nome","%".concat(e,"%")),l=(null==o?void 0:o.map(e=>e.id))||[];if(l.length>0)t=t.in("nome_livro",l);else{r([]),h(!1);return}}let{data:o,error:l}=await t;if(l||!o){console.error(l),alert("Erro ao buscar empr\xe9stimos: "+(null==l?void 0:l.message)),h(!1);return}let a=[];for(let e of o){let{data:t}=await s.O.from("livros").select("nome").eq("id",e.nome_livro).single(),r="Desconhecido";if("aluno"===e.tipo_solicitante){let{data:t}=await s.O.from("alunos").select("nome").eq("id",e.solicitante_id).single();r=(null==t?void 0:t.nome)||r}else if("funcionario"===e.tipo_solicitante){let{data:t}=await s.O.from("funcionarios").select("nome").eq("id",e.solicitante_id).single();r=(null==t?void 0:t.nome)||r}a.push({id:e.id,nome_livro:(null==t?void 0:t.nome)||"Desconhecido",nome_solicitante:r,tipo_solicitante:e.tipo_solicitante,data_emprestimo:new Date(e.data_emprestimo).toLocaleDateString(),data_devolucao:new Date(e.data_devolucao).toLocaleDateString(),devolvido:e.devolvido})}r(a),h(!1)};(0,l.useEffect)(()=>{f()},[]);let v=async e=>{if(confirm("Confirma a devolu\xe7\xe3o desse livro?"))try{let{data:t,error:r}=await s.O.from("emprestimos").select("nome_livro").eq("id",e).single();if(r||!t){alert("Erro ao localizar empr\xe9stimo.");return}let{data:o,error:l}=await s.O.from("livros").select("id, q_disponivel").eq("id",t.nome_livro).single();if(l||!o){alert("Erro ao localizar livro: "+(null==l?void 0:l.message));return}let{error:a}=await s.O.from("emprestimos").delete().eq("id",e);if(a){alert("Erro ao deletar empr\xe9stimo: "+a.message);return}let{error:n}=await s.O.from("livros").update({q_disponivel:o.q_disponivel+1}).eq("id",o.id);if(n){alert("Erro ao atualizar quantidade dispon\xedvel: "+n.message);return}alert("Livro devolvido com sucesso!"),f(i)}catch(e){console.error(e),alert("Erro inesperado ao devolver livro")}};return(0,o.jsxs)("div",{className:"min-h-screen bg-[#006400] flex flex-col items-center justify-start px-4 py-10 relative",children:[(0,o.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"absolute top-4 right-4 bg-white text-[#006400] rounded-full p-2 shadow-md hover:bg-emerald-100 transition","aria-label":"Voltar",children:(0,o.jsx)(n.Z,{className:"w-6 h-6"})}),(0,o.jsxs)("div",{className:"w-full max-w-6xl bg-[#2e8b57] rounded-[30px] p-8 shadow-2xl z-10 text-white",children:[(0,o.jsxs)("h1",{className:"text-4xl font-bold text-center mb-8 flex items-center justify-center gap-2 drop-shadow",children:[(0,o.jsx)(d.Z,{className:"w-8 h-8"})," Pesquisa de Empr\xe9stimos"]}),(0,o.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 mb-8",children:[(0,o.jsx)("input",{type:"text",value:i,onChange:e=>m(e.target.value),placeholder:"Filtrar por nome do livro...",className:"w-full md:w-2/3 px-6 py-3 rounded-full bg-[#006400] text-white font-medium placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white shadow-md"}),(0,o.jsxs)("button",{onClick:()=>f(i),className:"flex items-center gap-2 bg-white text-[#006400] font-semibold px-5 py-2 rounded-full hover:bg-emerald-100 transition shadow",children:[(0,o.jsx)(c.Z,{className:"w-5 h-5"})," Pesquisar"]})]}),x?(0,o.jsx)("p",{className:"text-center text-lg font-semibold",children:"Carregando..."}):0===t.length?(0,o.jsx)("p",{className:"text-center text-lg font-semibold",children:"Nenhum empr\xe9stimo encontrado."}):(0,o.jsx)("div",{className:"overflow-x-auto",children:(0,o.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{className:"bg-[#1f6f43] text-white text-sm sm:text-base",children:[(0,o.jsx)("th",{className:"px-4 py-3",children:"Livro"}),(0,o.jsx)("th",{className:"px-4 py-3",children:"Solicitante"}),(0,o.jsx)("th",{className:"px-4 py-3",children:"Tipo"}),(0,o.jsx)("th",{className:"px-4 py-3",children:"Data Empr\xe9stimo"}),(0,o.jsx)("th",{className:"px-4 py-3",children:"Data Devolu\xe7\xe3o"}),(0,o.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,o.jsx)("th",{className:"px-4 py-3 text-center",children:"A\xe7\xf5es"})]})}),(0,o.jsx)("tbody",{children:t.map(e=>(0,o.jsxs)("tr",{className:"odd:bg-[#2e8b57] even:bg-[#237e4d] text-white",children:[(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.nome_livro}),(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.nome_solicitante}),(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.tipo_solicitante}),(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.data_emprestimo}),(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.data_devolucao}),(0,o.jsx)("td",{className:"px-4 py-3 border border-[#006400]",children:e.devolvido?(0,o.jsxs)("span",{className:"flex items-center gap-1 text-green-300 font-semibold",children:[(0,o.jsx)(u,{className:"w-5 h-5"})," Devolvido"]}):(0,o.jsxs)("span",{className:"flex items-center gap-1 text-yellow-300 font-semibold",children:[(0,o.jsx)(p,{className:"w-5 h-5"})," Pendente"]})}),(0,o.jsxs)("td",{className:"px-4 py-3 border border-[#006400] text-center",children:[!e.devolvido&&(0,o.jsx)("button",{onClick:()=>v(e.id),className:"bg-red-600 hover:bg-red-700 text-white font-bold rounded-full px-4 py-2 shadow",children:"Devolver"}),e.devolvido&&(0,o.jsx)("button",{disabled:!0,className:"bg-gray-600 cursor-not-allowed text-white font-bold rounded-full px-4 py-2 opacity-60",children:"Devolvido"})]})]},e.id))})]})})]})]})},["funcionario","funcionario_administrador"])}},function(e){e.O(0,[888,774,179],function(){return e(e.s=9586)}),_N_E=e.O()}]);